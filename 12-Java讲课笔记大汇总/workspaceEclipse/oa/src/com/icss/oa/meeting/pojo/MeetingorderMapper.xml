<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="MEETINGORDER" >
  <resultMap id="BaseResultMap" type="com.icss.oa.meeting.pojo.Meetingorder" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 08 16:03:49 CST 2014.
    -->
    <id column="ORDER_ID" property="orderId" jdbcType="DECIMAL" />
    <result column="METTING_NAME" property="mettingName" jdbcType="VARCHAR" />
    <result column="EMP_ID" property="empId" jdbcType="DECIMAL" />
    <result column="ROOM_ID" property="roomId" jdbcType="DECIMAL" />
    <result column="ATTEND_PEOPLE" property="attendPeople" jdbcType="VARCHAR" />
    <result column="ATTEND_AMOUNT" property="attendAmount" jdbcType="DECIMAL" />
    <result column="START_TIME" property="startTime" jdbcType="TIMESTAMP" />
    <result column="END_TIME" property="endTime" jdbcType="TIMESTAMP" />
    <result column="DEV_NAME" property="devName" jdbcType="VARCHAR" />
    <result column="APRO_STATE" property="aproState" jdbcType="VARCHAR" />
  </resultMap>
  
  <insert id="insert" parameterType="com.icss.oa.meeting.pojo.Meetingorder" >
    insert into MEETINGORDER (ORDER_ID, METTING_NAME, EMP_ID, 
      ROOM_ID, ATTEND_PEOPLE, ATTEND_AMOUNT, 
      START_TIME, END_TIME, DEV_NAME,APRO_STATE)
    values (meetorder_seq.nextval, #{mettingName,jdbcType=VARCHAR}, #{empId,jdbcType=DECIMAL}, 
      #{roomId,jdbcType=DECIMAL}, #{attendPeople,jdbcType=VARCHAR}, #{attendAmount,jdbcType=DECIMAL}, 
      #{startTime,jdbcType=TIMESTAMP}, #{endTime,jdbcType=TIMESTAMP}, #{devName,jdbcType=VARCHAR},#{aproState,jdbcType=VARCHAR})
  </insert>
  
  <select id="queryById" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    *
    from MEETINGORDER
    where ORDER_ID = #{orderId,jdbcType=DECIMAL}
  </select>
  
  <select id="query" resultType="java.util.Map">
      select * from(
      select rownum rnum,m.*
	  from (select 
	               m.order_id,
	               m.metting_name,
	               e.emp_name,
	               mr.room_name,
	               m.apro_state
	          from meetingorder m
	         inner join emp e on m.emp_id = e.emp_id
	         inner join meetingroom mr on m.room_id = mr.room_id
	         <where>
			    <if test="empId!=null and empId!='' and empId!=0">
			        and m.emp_ID =#{empId,jdbcType=DECIMAL}
			    </if>
			 </where>
	         order by order_id desc) m)
	 where rnum between #{start} and #{end}
  </select>

  
  
  <select id="querymeeting" resultType="java.util.Map" >
  	select * from 
  	(select rownum rnum,m.*
	  from (select m.order_id,
	               m.metting_name,
	               e.emp_name,
	               mr.room_name,
	               m.START_TIME
	         from meetingorder m
	         inner join emp e on m.emp_id = e.emp_id
	         inner join meetingroom mr on m.room_id = mr.room_id
	         where APRO_STATE like '%批准%'       
			    <if test="empId!=null and empId!='' and empId!=0">
			        and m.emp_ID =#{empId,jdbcType=DECIMAL}
			    </if>
  
	         order by order_id desc) m)
	 where rnum between #{start} and #{end}
  </select>
  
  <update id="update" parameterType="com.icss.oa.meeting.pojo.Meetingorder" >
	    update MEETINGORDER
	    set METTING_NAME = #{mettingName,jdbcType=VARCHAR},
	      EMP_ID = #{empId,jdbcType=DECIMAL},
	      ROOM_ID = #{roomId,jdbcType=DECIMAL},
	      ATTEND_PEOPLE = #{attendPeople,jdbcType=VARCHAR},
	      ATTEND_AMOUNT = #{attendAmount,jdbcType=DECIMAL},
	      START_TIME = #{startTime,jdbcType=TIMESTAMP},
	      END_TIME = #{endTime,jdbcType=TIMESTAMP},
	      DEV_NAME = #{devName,jdbcType=VARCHAR},
	      APRO_STATE = #{aproState,jdbcType=VARCHAR}
	    where ORDER_ID = #{orderId,jdbcType=DECIMAL}
  	</update>
  <delete id="delete" parameterType="java.lang.Integer" >
   	delete from MEETINGORDER
    where ORDER_ID = #{orderId,jdbcType=DECIMAL}
  </delete>
    
  <select id="getCount" resultType="java.lang.Integer" parameterType="java.lang.Integer">
		select
		count(*)
		from MEETINGORDER 
		 <where>
			    <if test="value!=null and value!='' and value!=0">
			        and emp_ID =#{empId,jdbcType=DECIMAL}
			    </if>
		</where>	
	</select>
	
	<select id="getMeetingCount" resultType="java.lang.Integer" parameterType="java.lang.Integer">
		select
		count(*)
		from MEETINGORDER m
		   where APRO_STATE like '%批准%'       
			    <if test="value!=null and value!='' and value!=0">
			        and m.emp_ID =#{empId,jdbcType=DECIMAL}
			    </if>
	</select>
</mapper>