<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="Keywords" content="FreeMarker, template, templates, HTML, HTML template, page template, text, macro, macros, preprocessor, MVC, view, servlet, Java, free, open source, JSP, taglib, Velocity, WebMacro">
    <meta name="Description" content="Java template engine; a generic tool to generate text output (HTML, RTF, source code, etc.). Practical for servlet-based Web applications following the MVC pattern. Free.">
    <meta name="verify-v1" content="OU7KNU7q+wGizVoaX/MNUo/tZ5o5RC06VfCjQIRRJu4=">
    <link rel="STYLESHEET" type="text/css" href="site.css">
    <title>FreeMarker: Java Template Engine Library - Don't allow users visiting MVC Views directly!</title>
  </head>
  <body>
    <table border="0" cellspacing="0" cellpadding="0" width="100%">
      <tr>
        <td align="left" valign="top" width="20%">
  <table bgcolor="#E0E0E0" cellspacing="0" cellpadding="0" border="0" width="100%">
    <tr valign="top">
      <td height="1" width="1" bgcolor="black"><img src="images/none.gif" width="1" height="1" alt="" hspace="0" vspace="0" border="0"></td>
      <td height="1" bgcolor="black"><img src="images/none.gif" width="1" height="1" alt="" hspace="0" vspace="0" border="0"></td>
      <td height="1" width="1" bgcolor="black"><img src="images/none.gif" width="1" height="1" alt="" hspace="0" vspace="0" border="0"></td>
    </tr>
    <tr>
      <td width="1" bgcolor="black"><img src="images/none.gif" width="1" height="1" alt="" hspace="0" vspace="0" border="0"/></td>
      <td>
        <table bgcolor="#E0E0E0" cellspacing="0" cellpadding="0" border="0" width="100%" style="margin: 0px">
          <tr><td>

  <table bgcolor="#E0E0E0" border="0" cellspacing="10" cellpadding="0" width="100%">
    <tr><td colspan="2" align="center">
        <a href="http://freemarker.org"><img border="0" src="images/logo_e0e0e0.png" alt="FreeMarker logo"></a><br>&nbsp;
    </td></tr>

  
    <tr><td>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr><td width="100%">
      <b>About</b>
    </td></tr>
  </table>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="index.html">Overview</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="features.html">Features</a>
    </td>
  </tr>

      </table>
</td></tr>

    <tr><td>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr><td width="100%">
      <b>Download</b>
    </td></tr>
  </table>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="freemarkerdownload.html">FreeMarker</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="https://sourceforge.net/projects/freemarker/files/chinese-manual/FreeMarker_Manual_zh_CN.pdf/download">中文版手册（PDF）</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="editors.html">Editor/IDE plugins</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="fmpp.html">File generator tool (FMPP)</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="usCavalry.html">Migrating from Velocity</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="libraries.html">FTL Libraries</a>
    </td>
  </tr>

      </table>
</td></tr>

    <tr><td>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr><td width="100%">
      <b>Documentation</b>
    </td></tr>
  </table>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="docs/index.html">Table of Contents</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="docs/api/index.html">Short-cut to: Java API</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="docs/app_faq.html">Short-cut to: FAQ</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="docs/alphaidx.html">Short-cut to: Index</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="docs/app_versions.html">Short-cut to: Versions</a>
    </td>
  </tr>

      </table>
</td></tr>

    <tr><td>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr><td width="100%">
      <b>Community, help</b>
    </td></tr>
  </table>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="http://sourceforge.net/tracker/?func=add&amp;group_id=794&amp;atid=100794">REPORT BUGS HERE!</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="http://sourceforge.net/mail/?group_id=794">Mailing list subscription</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="gmane.html">Browse/search the mailing list archives</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="gmane.html">News (nntp) interface</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="https://sourceforge.net/forum/?group_id=794">Web forums</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="http://freemarker.org/builds/">Development builds (automatic)</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="http://freemarker.org/wiki">Wiki</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="http://freemarker.blogspot.com/">Blog</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="http://twitter.com/#!/freemarker">Twitter</a>
    </td>
  </tr>

      </table>
</td></tr>

    <tr><td>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr><td width="100%">
      <b>Miscellaneous</b>
    </td></tr>
  </table>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="poweredBy.html">Powered by FreeMarker</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="http://sourceforge.net/projects/freemarker">SourceForge project page</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="https://github.com/freemarker/freemarker">New source repo (2.4 only ATM)</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="http://sourceforge.net/scm/?type=svn&amp;group_id=794">Old source repo (everything else)</a>
    </td>
  </tr>

        <tr>
    <td align="left" valign="top"><img src="images/bullet_e0e0e0.png" width=7 height=10 alt="-">&nbsp;</td>
    <td width="93%" align="left">
      <a class="nav" href="whoWeAre.html">Who we are</a>
    </td>
  </tr>

      </table>
</td></tr>

  
  </table>

          </td></tr>
        </table>
      </td>
      <td width="1" bgcolor="black"><img src="images/none.gif" width="1" height="1" alt="" hspace="0" vspace="0" border="0"/></td>
    </tr>
    <tr valign="top">
      <td height="1" width="1" bgcolor="black"><img src="images/none.gif" width="1" height="1" alt="" hspace="0" vspace="0" border="0"></td>
      <td height="1" bgcolor="black"><img src="images/none.gif" width="1" height="1" alt="" hspace="0" vspace="0" border="0"></td>
      <td height="1" width="1" bgcolor="black"><img src="images/none.gif" width="1" height="1" alt="" hspace="0" vspace="0" border="0"></td>
    </tr>
  </table>            
        </td>
        <td align="left" valign="top" width="5%">
          &nbsp;
        </td>
        <td align="left" valign="top" width="72%">
          <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr><td align="right"><span class="pageTitle">Don't allow users visiting MVC Views directly!</span></td></tr>
            <tr bgcolor="#000000"><td><img src="images/none.gif" width=1 height=1 hspace="0" vspace="0" border="0" alt=""></td></tr>
          </table>

  
    <p>
      A rather dangerous security hole was discovered in Web applications
      with certain components and configuration, which can be exploited
      through FreeMarker.
    </p>
  

  
    <h2>Which systems are affected</h2>

      <p>Web applications using JSP Model-2 approach to implement MVC (like
      older versions of Struts and WebWorks) are POSSIBLY vulnerable if the
      templates have a publicly visitable URL (like
      http://example.com/foo.ftl). Having such visitable MVC Views, while is
      a bad practice, doesn't make the application vulnerable in itself,
      only combined with certain runtime environment settings unrelated to
      FreeMarker. No more details will be disclosed until FreeMarker 2.3.19
      (expected at the end of February, 2012), so users have a chance to secure
      their applications (see later how). Even if your system is not
      vulnerable, if you have directly visitable templates, you should apply
      the fix described below, as similar undiscovered exploits may exist.</p>

      <p>This security problem exists regardless of FreeMarker version.
      FreeMarker 2.3.19 will have a change to block this exploit in some
      cases, but not in all cases.</p>
    

    <h2>How to fix the issue</h2>

      <p>MVC Views should only be callable by the MVC Controller, even
      regardless of this security issue. They shouldn't have public URL-s,
      since they are internal implementation details. Indeed, most of them
      are dysfunctional without the Controller preparing the data-model.</p>
      
      <p>To fix this, add this to <code>WEB-INF/web.xml</code> before <code>&lt;/web-app></code> or
      <code>login-config</code> or <code>security-role</code> or <code>env-entry</code> or <code>ejb-ref</code>,
      whichever comes first:</p>
      
      <pre>
&lt;!--
  Prevent the visiting of MVC Views from outside the servlet container.
  RequestDispatcher.forward/include should and will still work.
  Removing this may open security holes!
-->
&lt;security-constraint>
  &lt;web-resource-collection>
    &lt;web-resource-name>FreeMarker MVC Views&lt;/web-resource-name>
    &lt;url-pattern>*.ftl&lt;/url-pattern>
  &lt;/web-resource-collection>
  &lt;auth-constraint>
    &lt;!-- Nobody is allowed to visit these -->
  &lt;/auth-constraint>
&lt;/security-constraint>
      </pre>
      
      <p>You have to replace the <code>*.ftl</code> pattern inside the <code>url-pattern</code>
      with the pattern that your FreeMarker view servlet (such as
      <code>FreemarkerServlet</code>) is mapped to.</p>
      
      <p>This requires Servlet 2.2 or later, and it always should be checked
      that visiting a template directly indeed gives an error (HTTP 403).</p>
      
      <p><i>Note: Modern Web application frameworks don't use the request-forwarding
      approach anymore for FreeMarker views. So possibly you can remove
      the related servlet declaration altogether, without breaking the
      application. It happens that it was just left there for no good
      reason.</i></p>
      
    
    
    <h2>Some question that may arise</h2>

      <p>    
      Q: What can the attacker do?<br />
      A: Sorry, no information will be released until 2.3.19.
      </p>    

      <p>    
      Q: Why don't you just release all the information now?<br />
      A: To give users a chance to secure their systems before that.
      </p>    

      <p>    
      Q: But now I don't know if my system is vulnerable!<br />
      A: You should apply the "security-constraint" fix regardless.
         Maybe even where you don't use FreeMarker.
      </p>    

      <p>    
      Q: Why don't you release 2.3.19 as soon as possible?<br />
      A: Because a source code change would expose what the problem is,
         while it wouldn't even give 100% protection.
      </p>    

      <p>    
      Q: Is this security issue being actively exploited now?<br />
      A: We are not aware of any incidents that use this exploit.
      </p>    
    

  

        </td>
        <td align="left" valign="top" width="3%" rowspan=3>
          &nbsp;
        </td>
      </tr>
    </table>

    <p>&nbsp;
    
    <table border=0 cellspacing=0 cellpadding=0 width="100%">
      <tr><td height=1 bgcolor="#C0C0C0"><img src="images/none.gif" width=1 height=1 alt=""></td></tr>
    </table>
    <table border=0 cellspacing=0 cellpadding=0 width="100%">
      <tr>
      <td align=left valign=top class="footnote"><font size="1">&nbsp;<br></font>
        <b>Found broken link or other problem with this site?</b><br>
        Report to: <a href="mailto:ddekanyREMOVEME@freemail.hu">ddekanyREMOVEME@freemail.hu</a><br>
        (remove the "REMOVEME" from the address)<br>
      </td>
      <td align=right valign=top class="footnote"><font size="1">&nbsp;<br></font>
        Page last generated: 2012-03-01 00:56:26 GMT<br>
        All content on this page is copyrighted by the FreeMarker project.<br>
        &nbsp;
      </td>
    </table>

    <table border=0 cellspacing=0 cellpadding=0 width="100%">
      <tr>
        <td width="100%">&nbsp;</td>
        <td valign="middle" align="right">
            <a href="http://sourceforge.net"><img src="images/sflogo.png" border="0" alt="SourceForge Logo"></a>
        </td>
        <td>
          &nbsp;&nbsp;
        </td>
        <td valign="middle" align="right">
          <a href="http://freemarker.org"><img src="images/poweredby_ffffff.png" alt="Powered by FreeMarker" border="0"></a>
        </td>
    </table>
  </body>
</html>



